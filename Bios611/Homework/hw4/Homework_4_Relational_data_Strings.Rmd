---
  title: "BIOS 611 HW4 Relational data (Chapter 13) and Strings (Chapter 14-15)"
  author: "Ty Darnell"
  date: "`r format(Sys.time(), '%m/%d/%Y')`"
  output: html_document
---
  (Due date: September 28 at 6 pm)

  This set of exercise is mostly taken from R for Data Science by Garrett Grolemund and Hadley Wickham.

```{r, setup, include=FALSE}
library(tidyverse)
library(nycflights13)
library(stringr)
```
# Exercise 1

1.  Imagine you wanted to draw on a map the route each plane flies from
    its origin to its destination. What variables would you need? What tables
    would you need to combine?

    Answer:
    
`origin` and `dest` from the `flights` table. longitude and latitude from `airports`.
  You would need to join `flights` and `airports`

    ```{r}

    ```


2.  We know that some days of the year are "special", and fewer people than
    usual fly on them. How might you represent that data as a data frame?
    What would be the primary keys of that table? How would it connect to the
    existing tables?

    Answer: 
add a table of special dates. The primary key is `date`. The values to match are `year` `month` `day`.
    ```{r}

    ```

# Exercise 2

1.  Add a surrogate key to `flights`.

    Answer: 

    ```{r}
flights%>% mutate(flight_id=row_number())%>%select(flight_id,everything())
    ```

2.  Identify the keys in the following datasets

    Answer: 

    ```{r}

    ```

    1.  `Lahman::Batting`,
    Answer: playerID, yearID, stint

    ```{r}
Lahman::Batting%>%count(playerID,yearID ,stint)%>%filter(n>1)
    ```

    2.  `babynames::babynames`
    Answer: year, sex, name

    ```{r}
babynames::babynames%>%group_by(year,sex,name)%>%filter(n()>1)%>%nrow()
    ```

    3.  `nasaweather::atmos`
    Answer:   lat, long, year, month

    ```{r}
nasaweather::atmos %>%
  group_by(lat, long, year, month) %>%
  filter(n() > 1) %>%
  nrow()
    ```


3.  Draw a diagram illustrating the connections between the `Batting`,
    `Master`, and `Salaries` tables in the Lahman package.  
    (A diagram does not have to be a perfect picture. It can be tables 
    with some explanation, or it can be a scanned image of your sketch.)

    Answer:
  Master - primary keys: playerid
  Batting - primary keys: yearID, stint
  foreign keys: playerID=Master$playerId
Salaries - primary keys: yearID, teamID, playerID
foreign keys: playerId=Master$playerID

    ```{r}

    ```

# Exercise 3

1.  Compute the average arrival delay by destination, then join on the `airports`
    data frame so you can show the spatial distribution of delays. Here's an
    easy way to draw a map of the United States:

    ```{r, eval = FALSE}
    airports %>%
      semi_join(flights, c("faa" = "dest")) %>%
      ggplot(aes(lon, lat)) +
        borders("state") +
        geom_point() +
        coord_quickmap()
    ```

    (Don't worry if you don't understand what `semi_join()` does --- you'll
    learn about it next.)

    You might want to use the `colour` of the points to display
    the average delay for each airport.

    Answer: 

    ```{r}
 mean_dest_delay <- flights%>%group_by(dest)%>%summarise(delay=mean(arr_delay,na.rm=T))%>%inner_join(airports,by=c(dest="faa"))
    
    mean_dest_delay%>%
    ggplot(aes(lon, lat,color=delay)) +
        borders("state") +
        geom_point() +
        coord_quickmap()
    ```

2.  Add the location of the origin _and_ destination (i.e. the `lat` and `lon`)
    to `flights`.

    Answer: 

    ```{r}
  locations <- airports %>%
  select(faa, lat, lon)
  
     flights%>%
select(year:day,hour,origin,dest)%>%left_join(locations,by=c("origin"="faa"))%>%left_join(locations,by=c("dest"="faa"))

    ```

3.  Is there a relationship between the age of a plane and its delays? 

    Answer: There is not a strong relationship between age and delays.

    ```{r}
    ages <- planes%>%mutate(age=2013-year)%>%select(tailnum,age)
  
flights %>%
  inner_join(ages, by = "tailnum") %>%
  group_by(age) %>%
  filter(!is.na(dep_delay)) %>%
  summarise(delay = mean(dep_delay)) %>%
  ggplot(aes(x = age, y = delay)) +
  geom_point()

    ```

4.  What happened on June 13 2013? Display the spatial pattern of delays,
    and then use Google to cross-reference with the weather.

    ```{r, eval = FALSE, include = FALSE}
    worst <- filter(flights, !is.na(dep_time), month == 6, day == 13)
    worst %>%
      group_by(dest) %>%
      summarise(delay = mean(arr_delay), n = n()) %>%
      filter(n > 5) %>%
      inner_join(airports, by = c("dest" = "faa")) %>%
      ggplot(aes(lon, lat)) +
        borders("state") +
        geom_point(aes(size = n, colour = delay)) +
        coord_quickmap()
    ```

    Answer: There were strong storms, called derechos that hit the southeast, and midwest primarily.

    ```{r}
flights%>% filter(year==2013,month==6,day==13)%>%
 group_by(dest)%>%summarise(delay=mean(arr_delay,na.rm=T))%>%inner_join(airports,by=c("dest"="faa"))%>% ggplot(aes(lon, lat,size=delay,color=delay)) +
    borders("state") +
   geom_point() +
     coord_quickmap()
    ```

# Exercise 4

1.  Filter flights to only show flights with planes that have flown at least 100
    flights.

    Answer: 

    ```{r}
flights100 = flights %>%group_by(tailnum)%>%count()%>%filter(n>=100)

flights%>%semi_join(flights100,by="tailnum")
    ```

2.  Combine `fueleconomy::vehicles` and `fueleconomy::common` to find only the
    records for the most common models.

    Answer: 

    ```{r}
    library(fueleconomy)
    
    vehicles%>%semi_join(common,by=c("make","model"))

    ```

3.  What does `anti_join(flights, airports, by = c("dest" = "faa"))` tell you?
    What does `anti_join(airports, flights, by = c("faa" = "dest"))` tell you?

    Answer: 
The first statement gives you flights that do not mach to an FAA listed airport.

The second statement gives you airports that dont have flights from NYC. 

    ```{r}

    ```

4.  You might expect that there's an implicit relationship between plane
    and airline, because each plane is flown by a single airline. Confirm
    or reject this hypothesis using the tools you've learned above.

    Answer: 
A plane could be sold or rented to another airline therefore it would not necessarily be associated with only one airline. There are 17 planes associated with more than one airline.
    ```{r}
flights%>%filter(!is.na(tailnum))%>%count(tailnum,carrier)%>%count(tailnum)%>%filter(nn>1)
    ```

# Exercise 5

1.  Given the corpus of common words in `stringr::words`, create regular
    expressions that find all words that:  
    
    (Put the regular expression after "Answer: " below. Feel free to experiment in the r code chunks. We will grade only the regular expression you put after "Answer: ")
```{r}

```

    1. Start with "y".  
    Answer: 
```{r}
str_view(words,"^y",match=T)
```

    1. End with "x"  
    Answer: 
```{r}
str_view(words,"x$",match=T)
```

    1. Are exactly three letters long. (Don't cheat by using `str_length()`!)  
    Answer: 
```{r}
str_view(words,"^...$",match=T)
```

    1. Have seven letters or more.

    Since this list is long, you might want to use the `match` argument to
    `str_view()` to show only the matching or non-matching words.  
    Answer: 
```{r}
str_view(words,".......",match=T)
```

2.  Create regular expressions to find all words that:  
  (Put the regular expression after "Answer: " below. Feel free to experiment in the r code chunks. We will grade only the regular expression you put after "Answer: ")
```{r}
```

    1. Start with a vowel.  
    Answer:
```{r}
str_view(words,"^[aeiou]",match=T)
```

    1. That only contain consonants. (Hint: thinking about matching
       "not"-vowels.)  
    Answer:
```{r}
str_view(words,"^[^aeiou]+$",match=T)
```

    1. End with `ed`, but not with `eed`.  
    Answer:
```{r}
str_view(words,"[^e]ed$",match=T)
```

    1. End with `ing` or `ise`.  
    Answer:
```{r}
str_view(words,"ing$|ise$",match=T)
```

3.  Create regular expressions to find all words that:  
  (Put the regular expression after "Answer: " below. Feel free to experiment in the r code chunks. We will grade only the regular expression you put after "Answer: ")
```{r}
```

    1. Start with three consonants.  
    Answer:
```{r}
 str_view(words,"^[^aeiou]{3}",match=T)
```

    1. Have three or more vowels in a row.  
    Answer:
```{r}
str_view(words,"[aeiou]{3,}",match=T)
```

    1. Have two or more vowel-consonant pairs in a row.  
    Answer:
```{r}
str_view(words,"([aeiou][^aeiou]){2,}",match=T)
```

4.  From the Harvard sentences data, extract:

```{r}

```

    1. The first word from each sentence.  
    (Assign this list of words to a variable called "first.words")  
```{r}
str_extract_all(sentences,"[a-zA-z]+")
```

    1. All words ending in `ing`.  
    (Assign this list of words to a variable called "ing.words")
```{r}
ing.words<- str_extract_all(sentences,"\\b[A-Za-z]+ing\\b")
ing.words[!is.na(ing.words)]
```

    1. All plurals.  
    (Assign this list of words to a variable called "plural.words")
```{r}
 plural.words <- str_extract_all(sentences,"\\b[A-Za-z]{3,}s\\b")

plural.words[!is.na(plural.words)]
```

5.   Switch the first and last letters in `words`.  
    (Note `words` here refer to the the corpus of common words in `stringr::words`. Assign this newly created corpus after switching to a variable called `words.switched`)
    
```{r}
str_replace_all(words,"^([A-Za-z])(.*)([a-z])$", "\\3\\2\\1")
```

6.  Split up a string like `"apples, pears, and bananas"` into individual components.  
    (Assign this vector of strings to a variable called `fruits`. Make sure to convert this into a vector by doing "%>% .[[1]]")
```{r}
f <- c("apples, pears, and bananas")
fruit <-  str_split(f, ", +(and +)?")[[1]]
```
